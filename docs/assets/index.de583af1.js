var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);export function __vite_legacy_guard(){import("data:text/javascript,")}import{f as i,t as s,l as a,j as o,a as n,S as r}from"./vendor.e74f4cfd.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const l={canvas:{width:300,height:250},network:{tickMs:50,minLatency:10,maxLatency:30},players:[{id:1,color:"#483D8B",x:10,y:10,size:20,keyUp:87,keyDown:83,keyLeft:65,keyRight:68},{id:2,color:"#6B8E23",x:270,y:220,size:20,keyUp:38,keyDown:40,keyLeft:37,keyRight:39}],physics:{worldScale:30,strength:10,borderThickness:5}};class c{constructor(){t(this,"_listeners",[])}addEventListener(e){this._listeners.includes(e)||this._listeners.push(e)}removeEventListener(e){const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}notify(e){this._listeners.forEach((t=>{t(e)}))}}const h=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),d=()=>(new Date).getTime();class m{constructor(e,t){this.playerId=e,this.command=t}}class g{constructor(e){t(this,"_peers",[]),t(this,"_minLatency",0),t(this,"_maxLatency",0),t(this,"_commandSentEmitter",new c),t(this,"_commandReceivedEmitter",new c),this.playerId=e}get commandSentEmitter(){return this._commandSentEmitter}get commandReceivedEmitter(){return this._commandReceivedEmitter}set minLatency(e){this._minLatency=e}set maxLatency(e){this._maxLatency=e}connect(e){this._peers.push(e)}closeConnections(){this._peers=[]}broadcast(e){this._peers.forEach((t=>{this._commandSentEmitter.notify(new m(t.playerId,e)),0===this.maxLatency?t.receive(this,e):setTimeout((()=>{t.receive(this,e)}),h(this._minLatency,this._maxLatency))}))}send(e,t){this._commandSentEmitter.notify(new m(e.playerId,t)),0===this.maxLatency?e.receive(this,t):setTimeout((()=>{e.receive(this,t)}),h(this._minLatency,this._maxLatency))}receive(e,t){this._commandReceivedEmitter.notify(new m(e.playerId,t))}}var p,y;(y=p||(p={})).INFO="INFO",y.WARN="WARN",y.ERROR="ERROR";class u{constructor(e,t,i){this.level=e,this.timestamp=t,this.text=i}toString(){const e=new Date;return e.setTime(this.timestamp),`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")} ${this.level.padEnd(5)} ${this.text}`}}class f{constructor(){t(this,"_traces",[])}get traces(){return this._traces}log(e,t){this._traces.unshift(new u(e,d(),t))}logInfo(e){this.log(p.INFO,e)}logWarn(e){this.log(p.WARN,e)}logError(e){this.log(p.ERROR,e)}clear(){this._traces=[]}toString(){const e=this._traces.reverse().join("\n");return this._traces.reverse(),e}}const S=new class{constructor(){t(this,"pressedKeys",[]),document.onkeydown=document.onkeyup=e=>{this.pressedKeys[e.keyCode]="keydown"===e.type}}isPressed(e){return this.pressedKeys[e]}};class v{constructor(e,i,s){t(this,"_tick"),t(this,"_playerId"),t(this,"_value"),this._tick=e,this._playerId=i,this._value=s}get tick(){return this._tick}get playerId(){return this._playerId}get value(){return this._value}clone(e){return new v(this._tick+(e?1:0),this._playerId,this._value)}toString(){return`P${this._playerId}:${this._value}`}toFullString(){return`tick ${this._tick} P${this._playerId}:${this._value}`}}class _{constructor(e,t,i){this.id=e,this.x=t,this.y=i}toString(){return`P${this.id} x=${this.x} y=${this.y}`}}class w{constructor(e,t){this.playerId=e,this.value=t}toString(){return`P${this.playerId}:${this.value}`}}class x{constructor(e,t,i){this.tick=e,this.players=t,this.commands=i}toString(){return`tick: ${this.tick}\n  ${this.players.join("\n  ")}\n  Commands: ${this.commands.join(" ")}`}}class k extends class{constructor(e){t(this,"_tick"),t(this,"_peerCount"),t(this,"_commands"),this._tick=e,this._commands=[]}get tick(){return this._tick}get peerCount(){return this._peerCount}set peerCount(e){this._peerCount=e}get commands(){return this._commands}incTick(){this._tick++}commandFromPlayer(e){return this._commands.find((t=>t.playerId===e))}clearCommands(){this._commands=[]}}{constructor(e,i){super(e),t(this,"_world"),t(this,"_bodies"),this._world=i,this._bodies=[];for(let t=i.getBodyList();t;t=t.getNext())this._bodies.unshift(t)}get world(){return this._world}get bodies(){return this._bodies}bodyFromPlayer(e){return this._bodies.find((t=>t.getUserData().id===e))}toString(){let e="";return this._bodies.forEach((t=>{!t.isStatic()&&t.getUserData()&&(e+=`    P${t.getUserData().id} x=${t.getPosition().x*l.physics.worldScale} y=${t.getPosition().x*l.physics.worldScale}\n`)})),`\nGameState tick: ${this._tick}\n  bodies:\n${e}  commands:\n    ${this._commands.join("\n    ")}`}clone(){const e=this.cloneWorld(this._world,this._bodies),t=new k(this._tick,e);return this._commands.forEach((e=>t.commands.push(e.clone(!1)))),t}cloneWorld(e,t){const a=i(s(e)),o=[];for(let i=a.getBodyList();i;i=i.getNext())o.unshift(i);for(let[i,s]of o.entries())null!==s&&s.setUserData(t[i].getUserData());return a}toLog(){const e=[];this._bodies.forEach((t=>{if(!t.isStatic()&&t.getUserData()){let i=t.getUserData();e.push(new _(i.id,t.getPosition().x*l.physics.worldScale,t.getPosition().y*l.physics.worldScale))}})),e.sort(((e,t)=>e.id>t.id?1:-1));const t=[];return this._commands.forEach((e=>{t.push(new w(e.playerId,e.value))})),t.sort(((e,t)=>e.playerId>t.playerId?1:-1)),new x(this._tick,e,t)}}class P{constructor(e,i){t(this,"_initialGameState"),t(this,"_startTime"),t(this,"_tickMs"),t(this,"_currentTick"),this.log=e,this.gameStateMachine=i,this._startTime=0,this._tickMs=50,this._currentTick=0}get tickMs(){return this._tickMs}set tickMs(e){this._tickMs=e}get currentTick(){return this._currentTick}start(e){return this._startTime=d(),this._currentTick=0,this._initialGameState=e,this._startTime}tickBasedOnTime(){return Math.floor((d()-this._startTime)/this._tickMs)}tickTime(e){return this._startTime+e*this.tickMs}}class $ extends P{constructor(){super(...arguments),t(this,"localCommand"),t(this,"localCommandDumped",!1),t(this,"remoteCommands",[])}start(e){return super.start(e)}tick(){let e=null;if(this.tickBasedOnTime()>this._currentTick){!this.localCommandDumped&&this.localCommand&&(this.localCommandDumped=!0,this._initialGameState.commands.push(this.localCommand));let t=0;const i=this.remoteCommands.length;for(let e=0;e<i;e++){let i=this.remoteCommands[e];i&&i.tick===this._initialGameState.tick&&(this._initialGameState.commands.push(i),this.remoteCommands.splice(e-t++,1))}this._initialGameState.commands.length<this._initialGameState.peerCount?this.log.logWarn(`Waiting commands for tick ${this._currentTick}: ${this._initialGameState.commands.length} of ${this._initialGameState.peerCount}`):(this._initialGameState.commands.sort(((e,t)=>e.playerId>t.playerId?1:-1)),this.log.logInfo(this._initialGameState.toString()),e=this._initialGameState.toLog(),this.gameStateMachine.compute(this._initialGameState),this._currentTick++,this._initialGameState.incTick(),this._initialGameState.clearCommands(),this.localCommand=void 0,this.localCommandDumped=!1)}return e}localCommandReceived(e,t){let i;return this.localCommand||(i=new v(this._currentTick,e,t),this.log.logInfo(`local command: ${i.toFullString()}`),this.localCommand=i),i}remoteCommandReceived(e){this.log.logInfo(`received command: ${e.toFullString()}`),this.remoteCommands.push(e)}getGameStateToRender(){return this._initialGameState}getGameState(e){return this._initialGameState.tick===e?this._initialGameState:null}}class C extends P{constructor(){super(...arguments),t(this,"localCommand"),t(this,"localCommandDumped",!1),t(this,"remoteCommands",[]),t(this,"prevGameState")}start(e){return super.start(e)}tick(){let e=null;if(this.tickBasedOnTime()>this._currentTick){!this.localCommandDumped&&this.localCommand&&(this.localCommandDumped=!0,this._initialGameState.commands.push(this.localCommand));let t=0;const i=this.remoteCommands.length;for(let e=0;e<i;e++){let i=this.remoteCommands[e];i&&i.tick===this._initialGameState.tick&&(this._initialGameState.commands.push(i),this.remoteCommands.splice(e-t++,1))}this._initialGameState.commands.length<this._initialGameState.peerCount?this.log.logWarn(`Waiting commands for tick ${this._currentTick}: ${this._initialGameState.commands.length} of ${this._initialGameState.peerCount}`):(this._initialGameState.commands.sort(((e,t)=>e.playerId>t.playerId?1:-1)),this.log.logInfo(this._initialGameState.toString()),e=this._initialGameState.toLog(),this.prevGameState=this._initialGameState.clone(),this.gameStateMachine.compute(this._initialGameState),this._currentTick++,this._initialGameState.incTick(),this._initialGameState.clearCommands(),this.localCommand=void 0,this.localCommandDumped=!1)}return e}localCommandReceived(e,t){let i;return this.localCommand||(i=new v(this._currentTick,e,t),this.log.logInfo(`local command: ${i.toFullString()}`),this.localCommand=i),i}remoteCommandReceived(e){this.log.logInfo(`received command: ${e.toFullString()}`),this.remoteCommands.push(e)}getGameStateToRender(){return this.prevGameState?this.prevGameState:this._initialGameState}getGameState(e){return this._initialGameState.tick===e?this._initialGameState:this.prevGameState&&this.prevGameState.tick===e?this.prevGameState:null}}class G{constructor(e,t,i,s,a,o,n,r){this.currentTime=e,this.currentGameState=t,this.currentGameStateTime=i,this.elapsed=s,this.nextGameState=a,this.nextGameStateTime=o,this.nextElapsed=n,this.tickTimeDiff=r}}class b extends class{constructor(e,i,s){t(this,"context"),t(this,"_debugBoxes",!0),this.log=e,this.canvas=i,this.netcode=s;const a=i.getContext("2d");if(!a)throw"Error getting context 2d";this.context=a}get debugBoxes(){return this._debugBoxes}set debugBoxes(e){this._debugBoxes=e}}{constructor(e,t,i){super(e,t,i),this.log=e,this.canvas=t,this.netcode=i}render(e){e?this.renderWithInterpolation():this.renderAsIs()}renderAsIs(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e=this.netcode.getGameStateToRender().world.getBodyList();e;e=e.getNext())e.getUserData()&&(e.isStatic()?this.drawStaticBody(e):this.drawDynamicBody(e))}renderWithInterpolation(){let e=d();const t=this.netcode.getGameStateToRender(),i=this.netcode.tickTime(t.tick),s=this.netcode.getGameState(t.tick+1),a=s?this.netcode.tickTime(s.tick):void 0;a&&(e-=a-i),e>i+this.netcode.tickMs&&(e=i+this.netcode.tickMs);const o=new G(e,t,i,(e-i)/1e3,s,s?this.netcode.tickTime(s.tick):void 0,a?(e-a)/1e3:0,a?(a-i)/1e3:this.netcode.tickMs/1e3);this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let n=t.world.getBodyList();n;n=n.getNext())n.getUserData()&&(n.isStatic()?this.drawStaticBody(n):this.drawDynamicBodyWithInterpolation(n,o))}drawStaticBody(e){let t=e.getUserData().width,i=e.getUserData().height;this.context.fillStyle="#708090",this.context.fillRect(e.getPosition().x*l.physics.worldScale-t/2,e.getPosition().y*l.physics.worldScale-i/2,t,i)}drawDynamicBody(e){let t=e.getUserData();this.context.fillStyle=t.color,this.context.fillRect(e.getPosition().x*l.physics.worldScale-t.size/2,e.getPosition().y*l.physics.worldScale-t.size/2,t.size,t.size)}drawDynamicBodyWithInterpolation(e,t){let i,s,a,o=e.getUserData(),n=0,r=0;if(t.nextGameState){if(i=t.nextGameState.bodyFromPlayer(e.getUserData().id),i){const s=e.getPosition(),a=i.getPosition(),o=e.getLinearVelocity(),l=i.getLinearVelocity();n=Math.sign(o.x)===Math.sign(l.x)?s.x+t.elapsed*(a.x-s.x)/t.tickTimeDiff:t.elapsed<-t.nextElapsed?s.x+o.x*t.elapsed:a.x+l.x*t.nextElapsed,r=Math.sign(o.y)===Math.sign(l.y)?s.y+t.elapsed*(a.y-s.y)/t.tickTimeDiff:t.elapsed<-t.nextElapsed?s.y+o.y*t.elapsed:a.y+l.y*t.nextElapsed}}else n=e.getPosition().x+e.getLinearVelocity().x*t.elapsed,r=e.getPosition().y+e.getLinearVelocity().y*t.elapsed;this._debugBoxes&&(s=e.getPosition().x*l.physics.worldScale-o.size/2,a=e.getPosition().y*l.physics.worldScale-o.size/2,this.context.beginPath(),this.context.rect(s,a,o.size,o.size),this.context.strokeStyle="red",this.context.stroke(),i&&(s=i.getPosition().x*l.physics.worldScale-o.size/2,a=i.getPosition().y*l.physics.worldScale-o.size/2,this.context.beginPath(),this.context.rect(s,a,o.size,o.size),this.context.strokeStyle="blue",this.context.stroke())),s=n*l.physics.worldScale-o.size/2,a=r*l.physics.worldScale-o.size/2,this.context.fillStyle=o.color,this.context.fillRect(s,a,o.size,o.size)}}const L=0,E=1,T=2,I=10,B=20,D=11,R=21,z=12,M=22;class U{constructor(e,i,s,a,o,n){t(this,"running",!1),t(this,"_log"),t(this,"_gameStateHistory"),t(this,"_networkConn"),t(this,"_deviceUpdatedEmitter",new c),t(this,"netcode"),t(this,"renderer"),t(this,"_npcs",0),t(this,"_interpolation",!0),this.playerId=e,this.keyUp=i,this.keyDown=s,this.keyLeft=a,this.keyRight=o,this.canvas=n,this._log=new f,this._networkConn=new g(e),this._networkConn.commandReceivedEmitter.addEventListener((e=>{this.messageReceived(e)})),this._gameStateHistory=[]}get log(){return this._log}get deviceUpdatedEmitter(){return this._deviceUpdatedEmitter}get gameStateHistory(){return this._gameStateHistory}get interpolation(){return this._interpolation}set interpolation(e){this._interpolation=e}get debugBoxes(){return this.renderer.debugBoxes}set debugBoxes(e){this.renderer.debugBoxes=e}connect(e){this._log.logInfo(`Connected to player ${e.playerId}`),this._networkConn.connect(e._networkConn)}reset(){this._log.clear(),this._gameStateHistory=[],this._networkConn.closeConnections()}play(e,t,i,s,a,o,n){this._npcs=a,this._networkConn.minLatency=i,this._networkConn.maxLatency=s,this._interpolation=o;const r=this.createWorld(),l=new k(0,r);l.peerCount=2,this.netcode=class{constructor(){}static build(e,t,i){return"stibbons"===e?new C(t,i):new $(t,i)}}.build(e,this._log,this),this.netcode.tickMs=t,this.netcode.start(l),this.renderer=new b(this.log,this.canvas,this.netcode),this.renderer.debugBoxes=n,this.running=!0,window.requestAnimationFrame((()=>{this.gameLoop()}))}pause(){this.running=!1}gameStateHistoryLog(){const e=this._gameStateHistory.reverse().join("\n");return this._gameStateHistory.reverse(),e}createStaticBody(e,t,i,s,o){const n=e.createBody({type:"static"});n.setUserData({width:s,height:o}),n.createFixture(a.Box(s/2/l.physics.worldScale,o/2/l.physics.worldScale)),n.setPosition(a.Vec2((t+s/2)/l.physics.worldScale,(i+o/2)/l.physics.worldScale))}createWorld(){const e=a.Vec2(0,0),t=a.World(e);this.createStaticBody(t,0,0,this.canvas.width,l.physics.borderThickness),this.createStaticBody(t,0,this.canvas.height-l.physics.borderThickness,this.canvas.width,l.physics.borderThickness),this.createStaticBody(t,0,0,l.physics.borderThickness,this.canvas.height),this.createStaticBody(t,this.canvas.width-l.physics.borderThickness,0,l.physics.borderThickness,this.canvas.height);const i={density:0,restitution:.4};l.players.forEach((e=>{const s=t.createBody({type:"dynamic",position:a.Vec2((e.x+e.size/2)/l.physics.worldScale,(e.y+e.size/2)/l.physics.worldScale),allowSleep:!1,awake:!0});s.createFixture(a.Box(e.size/2/l.physics.worldScale,e.size/2/l.physics.worldScale),i),s.setUserData(e)}));const s={density:0,restitution:1};let o=20;for(let n=0;n<this._npcs;n++){const e=t.createBody({type:"dynamic",position:a.Vec2((35+n*o+10)/l.physics.worldScale,(35+n*o+10)/l.physics.worldScale),allowSleep:!1,awake:!0});e.createFixture(a.Box(10/l.physics.worldScale,10/l.physics.worldScale),s),e.setUserData({id:100+n,size:o,color:"black"})}return t}gameLoop(){this.running&&(window.requestAnimationFrame((()=>{this.gameLoop()})),this.update(),this.draw())}update(){const e=(S.isPressed(this.keyUp)?E:S.isPressed(this.keyDown)?T:L)+(S.isPressed(this.keyLeft)?I:S.isPressed(this.keyRight)?B:L),t=this.netcode.localCommandReceived(this.playerId,e);t&&(this.log.logInfo(`sending command: ${t.toFullString()}`),this._networkConn.broadcast(t));let i=this.netcode.tick();null!=i&&this._gameStateHistory.unshift(i),this._deviceUpdatedEmitter.notify()}draw(){this.renderer.render(this._interpolation)}compute(e){const t=e;for(let i of t.commands){if(!i||i.value===L)continue;const e=t.bodies.find((e=>(e.getUserData()?e.getUserData().id:-1)==i.playerId));if(e){const t=i.value==B||i.value==M||i.value==R?l.physics.strength:i.value==I||i.value==z||i.value==D?-1*l.physics.strength:0,s=i.value==T||i.value==z||i.value==M?l.physics.strength:i.value==E||i.value==D||i.value==R?-1*l.physics.strength:0;this.log.logInfo(`apply command value ${i.value} to P${i.playerId}: force(x=${t} y=${s})`),e.applyForce(a.Vec2(t,s),e.getWorldCenter())}}t.world.step(this.netcode.tickMs/1e3),t.world.clearForces()}messageReceived(e){this.netcode.remoteCommandReceived(e.command)}}(new class{constructor(){t(this,"devicePlayer1"),t(this,"devicePlayer2"),t(this,"panelGamestates1"),t(this,"panelLog1"),t(this,"panelGamestates2"),t(this,"panelLog2"),this.devicePlayer1=new U(l.players[0].id,l.players[0].keyUp,l.players[0].keyDown,l.players[0].keyLeft,l.players[0].keyRight,document.getElementById("player1GameArea")),this.devicePlayer2=new U(l.players[1].id,l.players[1].keyUp,l.players[1].keyDown,l.players[1].keyLeft,l.players[1].keyRight,document.getElementById("player2GameArea"))}build(){this.createWindows(),this.bootstrapAngular()}createWindows(){o.create({headerTitle:"Control Panel",theme:"dimgrey",dragit:!1,headerControls:{close:"remove",maximize:"remove",normalize:"remove",minimize:"remove",smallify:"remove"},panelSize:{width:"100%",height:"150px"},position:{my:"left-top",at:"left-top",offsetX:"0",offsetY:"calc(100vh - 150px)"},content:document.getElementById("controlPanel")}),this.panelGamestates1=o.create({headerTitle:"Player 1 Game States",theme:"navy",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},resizeit:{handles:"n,s"},panelSize:{width:"350px",height:"calc(100vh - 150px)"},position:{my:"left-top",at:"left-top",offsetX:"0",offsetY:"0"},content:document.getElementById("player1GameStates")}),o.create({headerTitle:"Player 1 Canvas",theme:"DarkSlateBlue",contentOverflow:"hide",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(50vw - 350px)",height:"calc(100vh - 350px)"},position:{my:"left-top",at:"left-top",offsetX:"350px",offsetY:"0"},content:document.getElementById("player1Canvas")}),this.panelLog1=o.create({headerTitle:"Player 1 Logs",theme:"RoyalBlue",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(50vw - 350px)",height:"200px"},position:{my:"left-top",at:"left-top",offsetX:"350px",offsetY:"calc(100vh - 350px)"},content:document.getElementById("player1Logs")}),this.panelGamestates2=o.create({headerTitle:"Player 2 Game States",theme:"olive",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"350px",height:"calc(100vh - 150px)"},position:{my:"left-top",at:"left-top",offsetX:"calc(100vw - 350px)",offsetY:"0"},content:document.getElementById("player2GameStates")}),o.create({headerTitle:"Player 2 Canvas",theme:"OliveDrab",contentOverflow:"hide",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(50vw - 350px)",height:"calc(100vh - 350px)"},position:{my:"left-top",at:"left-top",offsetX:"50vw",offsetY:"0"},content:document.getElementById("player2Canvas")}),this.panelLog2=o.create({headerTitle:"Player 2 Logs",theme:"LightGreen",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(50vw - 350px)",height:"200px"},position:{my:"left-top",at:"left-top",offsetX:"50vw",offsetY:"calc(100vh - 350px)"},content:document.getElementById("player2Logs")})}bootstrapAngular(){n.module("app",[]).controller("mainCtrl",["$scope",e=>{e.info={btnStopEnabled:!1,btnPlayEnabled:!0,btnSaveEnabled:!0,tick:l.network.tickMs,algorithm:"naive",latency:{min:l.network.minLatency,max:l.network.maxLatency},npcs:0,realtimeGameStates:!1,realtimeLogs:!1,interpolation:!0,debugBoxes:!0,logsPlayer1:[],logsPlayer2:[],gamestatesPlayer1:[],gamestatesPlayer2:[]},this.devicePlayer1.deviceUpdatedEmitter.addEventListener((()=>{e.$apply()})),this.devicePlayer2.deviceUpdatedEmitter.addEventListener((()=>{e.$apply()})),this.panelGamestates1.addControl({html:'<span class="fas fa-download"></span>',name:"download",position:1,handler:()=>{e.saveGamestates1()}}),this.panelLog1.addControl({html:'<span class="fas fa-download"></span>',name:"download",position:1,handler:()=>{e.saveLogs1()}}),this.panelGamestates2.addControl({html:'<span class="fas fa-download"></span>',name:"download",position:1,handler:()=>{e.saveGamestates2()}}),this.panelLog2.addControl({html:'<span class="fas fa-download"></span>',name:"download",position:1,handler:()=>{e.saveLogs2()}}),e.stop=()=>{this.devicePlayer1.pause(),this.devicePlayer2.pause(),e.info.btnStopEnabled=!1,e.info.btnPlayEnabled=!0,e.info.realtimeGameStates||(e.info.gamestatesPlayer1=this.devicePlayer1.gameStateHistory,e.info.gamestatesPlayer2=this.devicePlayer2.gameStateHistory),e.info.realtimeLogs||(e.info.logsPlayer1=this.devicePlayer1.log.traces,e.info.logsPlayer2=this.devicePlayer2.log.traces)},e.play=()=>{this.devicePlayer1.reset(),this.devicePlayer2.reset(),this.devicePlayer1.connect(this.devicePlayer2),this.devicePlayer2.connect(this.devicePlayer1),this.devicePlayer1.play(e.info.algorithm,e.info.tick,e.info.latency.min,e.info.latency.max,e.info.npcs,e.info.interpolation,e.info.debugBoxes),this.devicePlayer2.play(e.info.algorithm,e.info.tick,e.info.latency.min,e.info.latency.max,e.info.npcs,e.info.interpolation,e.info.debugBoxes),e.info.btnStopEnabled=!0,e.info.btnPlayEnabled=!1,e.checkRealtimeInfo()},e.checkRealtimeInfo=()=>{e.info.realtimeGameStates?(e.info.gamestatesPlayer1=this.devicePlayer1.gameStateHistory,e.info.gamestatesPlayer2=this.devicePlayer2.gameStateHistory):(e.info.gamestatesPlayer1=[],e.info.gamestatesPlayer2=[]),e.info.realtimeLogs?(e.info.logsPlayer1=this.devicePlayer1.log.traces,e.info.logsPlayer2=this.devicePlayer2.log.traces):(e.info.logsPlayer1=[],e.info.logsPlayer2=[])},e.changeInterpolation=()=>{this.devicePlayer1.interpolation=e.info.interpolation,this.devicePlayer2.interpolation=e.info.interpolation},e.changeDebugBoxes=()=>{this.devicePlayer1.debugBoxes=e.info.debugBoxes,this.devicePlayer2.debugBoxes=e.info.debugBoxes},e.saveAll=()=>{const t=new Date,i=r.exports.createWriteStream(`${t.getFullYear()}${t.getMonth()}${t.getDate()}${t.getHours()}${t.getMinutes()}${t.getSeconds()}-${e.info.algorithm}.log`).getWriter(),s=new TextEncoder,a=`--------------------\nPLAYER 1 GAME STATES\n--------------------\n${this.devicePlayer1.gameStateHistoryLog()}\n-------------\nPLAYER 1 LOGS\n-------------\n${this.devicePlayer1.log}\n\n--------------------\nPLAYER 2 GAME STATES\n--------------------\n${this.devicePlayer2.gameStateHistoryLog()}\n-------------\nPLAYER 2 LOGS\n-------------\n${this.devicePlayer2.log}`,o=s.encode(a);i.write(o),i.close()},e.saveGamestates1=()=>{const t=new Date,i=r.exports.createWriteStream(`${t.getFullYear()}${t.getMonth()}${t.getDate()}${t.getHours()}${t.getMinutes()}${t.getSeconds()}-${e.info.algorithm}-p1states.log`).getWriter(),s=(new TextEncoder).encode(this.devicePlayer1.gameStateHistoryLog());i.write(s),i.close()},e.saveLogs1=()=>{const t=new Date,i=r.exports.createWriteStream(`${t.getFullYear()}${t.getMonth()}${t.getDate()}${t.getHours()}${t.getMinutes()}${t.getSeconds()}-${e.info.algorithm}-p1logs.log`).getWriter(),s=(new TextEncoder).encode(this.devicePlayer1.log.toString());i.write(s),i.close()},e.saveGamestates2=()=>{const t=new Date,i=r.exports.createWriteStream(`${t.getFullYear()}${t.getMonth()}${t.getDate()}${t.getHours()}${t.getMinutes()}${t.getSeconds()}-${e.info.algorithm}-p2states.log`).getWriter(),s=(new TextEncoder).encode(this.devicePlayer2.gameStateHistoryLog());i.write(s),i.close()},e.saveLogs2=()=>{const t=new Date,i=r.exports.createWriteStream(`${t.getFullYear()}${t.getMonth()}${t.getDate()}${t.getHours()}${t.getMinutes()}${t.getSeconds()}-${e.info.algorithm}-p2logs.log`).getWriter(),s=(new TextEncoder).encode(this.devicePlayer2.log.toString());i.write(s),i.close()}}])}}).build();
