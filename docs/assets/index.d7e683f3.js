var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);export function __vite_legacy_guard(){import("data:text/javascript,")}import{f as i,t as s,l as o,j as n,S as a,a as r}from"./vendor.e74f4cfd.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const l=0,c=1,h=2,m=10,d=20,p=11,g=21,y=12,f=22,S={canvas:{width:300,height:250},network:{tickMs:50,minLatency1:10,maxLatency1:30,packetLoss1:0,minLatency2:10,maxLatency2:30,packetLoss2:0},netcodes:[{name:"p2p-naive",type:"p2p"},{name:"p2p-delayed",type:"p2p"},{name:"cs-lockstep",type:"cs"}],players:[{id:1,color:"#483D8B",x:10,y:10,size:20,keyUp:87,keyDown:83,keyLeft:65,keyRight:68},{id:2,color:"#6B8E23",x:270,y:220,size:20,keyUp:38,keyDown:40,keyLeft:37,keyRight:39}],npc:{color:"black"},border:{color:"#708090"},physics:{worldScale:30,strength:10,borderThickness:5}};class u{constructor(){t(this,"_listeners",[])}addEventListener(e){this._listeners.includes(e)||this._listeners.push(e)}removeEventListener(e){const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}removeListeners(){this._listeners=[]}notify(e){this._listeners.forEach((t=>{t(e)}))}}const v=()=>(new Date).getTime();class _{constructor(e){t(this,"connections",[]),t(this,"_connectionEmitter",new u),t(this,"_disconnectionEmitter",new u),t(this,"_messageSentEmitter",new u),t(this,"_messageReceivedEmitter",new u),this.log=e}get connectionCount(){return this.connections.length}get connectionEmitter(){return this._connectionEmitter}get disconnectionEmitter(){return this._disconnectionEmitter}get messageSentEmitter(){return this._messageSentEmitter}get messageReceivedEmitter(){return this._messageReceivedEmitter}connect(e,t){this.attachListeners(e),this.connections.push(e),e.connect(t),0===t.peerId?this.log.logInfo("Connected to Server"):this.log.logInfo(`Connected to Player ${t.peerId}`)}attachListeners(e){e.connectionEmitter.addEventListener((e=>{this._connectionEmitter.notify(e)})),e.disconnectionEmitter.addEventListener((e=>{this._disconnectionEmitter.notify(e)})),e.messageReceivedEmitter.addEventListener((e=>{this._messageReceivedEmitter.notify(e)})),e.messageSentEmitter.addEventListener((e=>{this._messageSentEmitter.notify(e)}))}findConnection(e){return this.connections.find((t=>t.peer.peerId===e))}closeConnections(){this.connections.forEach((e=>{0===e.peer.peerId?this.log.logInfo("Disconnected from Server"):this.log.logInfo(`Disconnected from Player ${e.peer.peerId}`),this._disconnectionEmitter.notify(e)})),this.connections=[]}resetEmitters(){this._connectionEmitter.removeListeners(),this._disconnectionEmitter.removeListeners(),this._messageSentEmitter.removeListeners(),this._messageReceivedEmitter.removeListeners()}broadcast(e){this.connections.forEach((t=>{t.send(e)}))}send(e,t){var i;null==(i=this.findConnection(e))||i.send(t)}}class w{constructor(e,i){t(this,"_peer"),t(this,"_minLatency",0),t(this,"_maxLatency",0),t(this,"_packetLoss",0),t(this,"_totalSent",0),t(this,"_totalLost",0),t(this,"_connectionEmitter",new u),t(this,"_disconnectionEmitter",new u),t(this,"_messageSentEmitter",new u),t(this,"_messageReceivedEmitter",new u),this.peerId=e,this.log=i}get connectionEmitter(){return this._connectionEmitter}get disconnectionEmitter(){return this._disconnectionEmitter}get messageSentEmitter(){return this._messageSentEmitter}get messageReceivedEmitter(){return this._messageReceivedEmitter}get peer(){return this._peer}set minLatency(e){this._minLatency=e}set maxLatency(e){this._maxLatency=e}set packetLoss(e){this._packetLoss=e}connect(e){this._peer=e,this._connectionEmitter.notify(e)}send(e){if(e.timestampOrigin=v(),e.origin=this.peerId,e.destination=this._peer.peerId,this._packetLoss>0&&this._totalLost+1<this._totalSent*this._packetLoss/100)return this.log.logWarn(`Message for tick ${e.tick} lost`),void this._totalLost++;var t,i;this._totalSent++,this._messageSentEmitter.notify(e),0===this.maxLatency?this._peer.receive(e):setTimeout((()=>{this._peer.receive(e)}),(t=this._minLatency,i=this._maxLatency,Math.floor(Math.random()*(i-t+1)+t)))}receive(e){e.timestampDestination=v(),this._messageReceivedEmitter.notify(e)}}var k,x;(x=k||(k={})).INFO="INFO",x.WARN="WARN",x.ERROR="ERROR";const L=class{constructor(e,i,s){t(this,"_id"),this.level=e,this.timestamp=i,this.text=s,this._id=L.idCounter++}get id(){return this._id}toString(){const e=new Date;return e.setTime(this.timestamp),`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")} ${this.level.padEnd(5)} ${this.text}`}};let E=L;t(E,"idCounter",0);class G{constructor(){t(this,"_traces",[])}get traces(){return this._traces}log(e,t){this._traces.unshift(new E(e,v(),t))}logInfo(e){this.log(k.INFO,e)}logWarn(e){this.log(k.WARN,e)}logError(e){this.log(k.ERROR,e)}clear(){this._traces=[]}toString(){const e=this._traces.reverse().join("\n");return this._traces.reverse(),e}}class C{constructor(e,i,s){t(this,"_tick"),t(this,"_playerId"),t(this,"_value"),this._tick=e,this._playerId=i,this._value=s}get tick(){return this._tick}get playerId(){return this._playerId}get value(){return this._value}clone(e){return new C(this._tick+(e?1:0),this._playerId,this._value)}toString(){return`P${this._playerId}:${this._value}`}toFullString(){return`tick ${this._tick} P${this._playerId}:${this._value}`}}class b{constructor(e,t,i){this.id=e,this.x=t,this.y=i}toString(){return`P${this.id} x=${this.x} y=${this.y}`}}class T{constructor(e,t){this.playerId=e,this.value=t}toString(){return`P${this.playerId}:${this.value}`}}class P{constructor(e,t,i){this.tick=e,this.players=t,this.commands=i}toString(){return`tick: ${this.tick}\n  ${this.players.join("\n  ")}\n  Commands: ${this.commands.join(" ")}`}}class I{constructor(e){t(this,"_tick"),t(this,"_commands"),this._tick=e,this._commands=[]}get tick(){return this._tick}get commands(){return this._commands}incTick(){this._tick++}commandFromPlayer(e){return this._commands.find((t=>t.playerId===e))}clearCommands(){this._commands=[]}}class ${compute(e){}}class B{constructor(e,i,s){t(this,"_timestampOrigin"),t(this,"_timestampDestination"),this.tick=e,this.origin=i,this.destination=s}get timestampOrigin(){return this._timestampOrigin}set timestampOrigin(e){this._timestampOrigin=e}get timestampDestination(){return this._timestampDestination}set timestampDestination(e){this._timestampDestination=e}}class R extends B{constructor(e,i,s){super(e.tick,i,s),t(this,"_command"),this._command=e}get command(){return this._command}}class D extends B{constructor(e,i,s){super(e.tick,i,s),t(this,"_gameState"),this._gameState=e}get gameState(){return this._gameState}}class z{constructor(e,t,i,s,o,n,a,r,l){this.id=e,this.isStatic=t,this.posX=i,this.posY=s,this.velX=o,this.velY=n,this.width=a,this.height=r,this.color=l}clone(){return new z(this.id,this.isStatic,this.posX,this.posY,this.velX,this.velY,this.width,this.height,this.color)}}class Y extends I{constructor(e,i){super(e),t(this,"_bodies"),this._bodies=i}get bodies(){return this._bodies}bodyFromPlayer(e){return this._bodies.find((t=>t.id===e))}toString(){let e="";return this._bodies.forEach((t=>{t.isStatic||(e+=`    P${t.id} x=${t.posX*S.physics.worldScale} y=${t.posY*S.physics.worldScale}\n`)})),`\nGameState tick: ${this._tick}\n  bodies:\n${e}  commands:\n    ${this._commands.join("\n    ")}`}clone(){const e=[];this._bodies.forEach((t=>{e.push(t.clone())}));const t=new Y(this._tick,this._bodies);return this._commands.forEach((e=>t.commands.push(e.clone(!1)))),t}toLog(){const e=[];this._bodies.forEach((t=>{t.isStatic||e.push(new b(t.id,t.posX*S.physics.worldScale,t.posY*S.physics.worldScale))})),e.sort(((e,t)=>e.id>t.id?1:-1));const t=[];return this._commands.forEach((e=>{t.push(new T(e.playerId,e.value))})),t.sort(((e,t)=>e.playerId>t.playerId?1:-1)),new P(this._tick,e,t)}}class X extends I{constructor(e,i){super(e),t(this,"_world"),t(this,"_bodies"),this._world=i,this._bodies=[];for(let t=i.getBodyList();t;t=t.getNext())this._bodies.unshift(t)}get world(){return this._world}get bodies(){return this._bodies}bodyFromPlayer(e){return this._bodies.find((t=>t.getUserData().id===e))}toString(){let e="";return this._bodies.forEach((t=>{!t.isStatic()&&t.getUserData()&&(e+=`    P${t.getUserData().id} x=${t.getPosition().x*S.physics.worldScale} y=${t.getPosition().y*S.physics.worldScale}\n`)})),`\nGameState tick: ${this._tick}\n  bodies:\n${e}  commands:\n    ${this._commands.join("\n    ")}`}clone(){const e=this.cloneWorld(this._world,this._bodies),t=new X(this._tick,e);return this._commands.forEach((e=>t.commands.push(e.clone(!1)))),t}cloneWorld(e,t){const o=i(s(e)),n=[];for(let i=o.getBodyList();i;i=i.getNext())n.unshift(i);for(let[i,s]of n.entries())null!==s&&s.setUserData(t[i].getUserData());return o}toLog(){const e=[];this._bodies.forEach((t=>{if(!t.isStatic()&&t.getUserData()){let i=t.getUserData();e.push(new b(i.id,t.getPosition().x*S.physics.worldScale,t.getPosition().y*S.physics.worldScale))}})),e.sort(((e,t)=>e.id>t.id?1:-1));const t=[];return this._commands.forEach((e=>{t.push(new T(e.playerId,e.value))})),t.sort(((e,t)=>e.playerId>t.playerId?1:-1)),new P(this._tick,e,t)}buildSimpleGameState(){const e=[];return this._bodies.forEach((t=>{if(!t.isStatic()){let i=t.getUserData();const s=new z(i.id,!1,t.getPosition().x,t.getPosition().y,t.getLinearVelocity().x,t.getLinearVelocity().y,i.size,i.size,i.color);e.push(s)}if(t.isStatic()){const i=new z(-1,!0,t.getPosition().x,t.getPosition().y,t.getLinearVelocity().x,t.getLinearVelocity().y,t.getUserData().width,t.getUserData().height,S.border.color);e.push(i)}})),new Y(this.tick,e)}}class M{constructor(e,i,s){t(this,"_initialGameState"),t(this,"_startTime"),t(this,"_tickMs"),t(this,"_currentTick"),this.log=e,this.net=i,this.gameStateMachine=s,this._startTime=0,this._tickMs=50,this._currentTick=0,this.net.messageReceivedEmitter.addEventListener((e=>{e instanceof R?this.remoteCommandReceived(e.command):e instanceof D?this.gameStateReceived(e.gameState):this.log.logError(`Unknown message received: ${e}`)}))}get tickMs(){return this._tickMs}set tickMs(e){this._tickMs=e}get currentTick(){return this._currentTick}start(e){return this._startTime=v(),this._currentTick=0,e&&(this._initialGameState=e),this._startTime}tickBasedOnTime(){return Math.floor((v()-this._startTime)/this._tickMs)}tickTime(e){return this._startTime+e*this.tickMs}}class U extends M{constructor(){super(...arguments),t(this,"localCommandTick",-1),t(this,"lastTickReturned",-1)}tick(){let e=null;return this.lastTickReturned<this._currentTick&&this._initialGameState&&(this.lastTickReturned=this._currentTick,this.log.logInfo(this._initialGameState.toString()),e=this._initialGameState.toLog()),e}localCommandReceived(e,t){if(this.localCommandTick<this._currentTick){this.localCommandTick=this._currentTick;const i=new C(this._currentTick,e,t);this.log.logInfo(`sending local command: ${i.toFullString()}`),this.net.broadcast(new R(i))}}remoteCommandReceived(e){throw new Error("CSLockstepClientNetCode: does not support receiving remote commands")}gameStateReceived(e){this.log.logInfo(`received gamestate: ${e.toLog()}`),e.tick<this._currentTick?this.log.logInfo(`ignoring old gamestate: ${e.tick}`):(this._initialGameState=e,this._currentTick=e.tick)}getGameStateToRender(){return this._initialGameState}getGameState(e){return this._initialGameState.tick===e?this._initialGameState:null}}class O extends M{constructor(){super(...arguments),t(this,"initialGameStateSent",!1),t(this,"remoteCommands",[])}tick(){let e=null;if(!this.initialGameStateSent){this.initialGameStateSent=!0;const t=this._initialGameState.buildSimpleGameState();this.log.logInfo(`sending gamestate: ${t.toLog()}`),this.net.broadcast(new D(t)),e=this._initialGameState.toLog()}if(this.tickBasedOnTime()>this._currentTick){let t=0;const i=this.remoteCommands.length;for(let e=0;e<i;e++){let i=this.remoteCommands[e];i&&i.tick===this._initialGameState.tick&&(this._initialGameState.commands.push(i),this.remoteCommands.splice(e-t++,1))}if(this._initialGameState.commands.length<this.net.connectionCount)this.log.logWarn(`Waiting commands for tick ${this._currentTick}: ${this._initialGameState.commands.length} of ${this.net.connectionCount}`);else{this._initialGameState.commands.sort(((e,t)=>e.playerId>t.playerId?1:-1)),this.log.logInfo(this._initialGameState.toString()),this.gameStateMachine.compute(this._initialGameState),this._currentTick++,this._initialGameState.incTick(),this._initialGameState.clearCommands();const t=this._initialGameState.buildSimpleGameState();this.log.logInfo(`sending gamestate: ${t.toLog()}`),this.net.broadcast(new D(t)),e=this._initialGameState.toLog()}}return e}localCommandReceived(e,t){throw new Error("CSLockstepServerNetCode: does not support receiving local commands")}remoteCommandReceived(e){this.log.logInfo(`received command: ${e.toFullString()}`),this.remoteCommands.push(e)}gameStateReceived(e){throw new Error("CSLockstepServerNetCode: does not support receiving game states")}getGameStateToRender(){return this._initialGameState}getGameState(e){return this._initialGameState.tick===e?this._initialGameState:null}}class F extends M{constructor(){super(...arguments),t(this,"localCommand"),t(this,"localCommandDumped",!1),t(this,"remoteCommands",[])}start(e){return super.start(e)}tick(){let e=null;if(this.tickBasedOnTime()>this._currentTick){!this.localCommandDumped&&this.localCommand&&(this.localCommandDumped=!0,this._initialGameState.commands.push(this.localCommand));let t=0;const i=this.remoteCommands.length;for(let e=0;e<i;e++){let i=this.remoteCommands[e];i&&i.tick===this._initialGameState.tick&&(this._initialGameState.commands.push(i),this.remoteCommands.splice(e-t++,1))}this._initialGameState.commands.length<this.net.connectionCount+1?this.log.logWarn(`Waiting commands for tick ${this._currentTick}: ${this._initialGameState.commands.length} of ${this.net.connectionCount+1}`):(this._initialGameState.commands.sort(((e,t)=>e.playerId>t.playerId?1:-1)),this.log.logInfo(this._initialGameState.toString()),e=this._initialGameState.toLog(),this.gameStateMachine.compute(this._initialGameState),this._currentTick++,this._initialGameState.incTick(),this._initialGameState.clearCommands(),this.localCommand=void 0,this.localCommandDumped=!1)}return e}localCommandReceived(e,t){if(!this.localCommand){const i=new C(this._currentTick,e,t);this.localCommand=i,this.log.logInfo(`sending local command: ${i.toFullString()}`),this.net.broadcast(new R(i))}}remoteCommandReceived(e){this.log.logInfo(`received command: ${e.toFullString()}`),this.remoteCommands.push(e)}gameStateReceived(e){throw new Error("P2PNaiveNetCode: Method not implemented.")}getGameStateToRender(){return this._initialGameState}getGameState(e){return this._initialGameState.tick===e?this._initialGameState:null}}class W extends M{constructor(){super(...arguments),t(this,"localCommand"),t(this,"localCommandDumped",!1),t(this,"remoteCommands",[]),t(this,"prevGameState")}start(e){return super.start(e)}tick(){let e=null;if(this.tickBasedOnTime()>this._currentTick){!this.localCommandDumped&&this.localCommand&&(this.localCommandDumped=!0,this._initialGameState.commands.push(this.localCommand));let t=0;const i=this.remoteCommands.length;for(let e=0;e<i;e++){let i=this.remoteCommands[e];i&&i.tick===this._initialGameState.tick&&(this._initialGameState.commands.push(i),this.remoteCommands.splice(e-t++,1))}this._initialGameState.commands.length<this.net.connectionCount+1?this.log.logWarn(`Waiting commands for tick ${this._currentTick}: ${this._initialGameState.commands.length} of ${this.net.connectionCount+1}`):(this._initialGameState.commands.sort(((e,t)=>e.playerId>t.playerId?1:-1)),this.log.logInfo(this._initialGameState.toString()),e=this._initialGameState.toLog(),this.prevGameState=this._initialGameState.clone(),this.gameStateMachine.compute(this._initialGameState),this._currentTick++,this._initialGameState.incTick(),this._initialGameState.clearCommands(),this.localCommand=void 0,this.localCommandDumped=!1)}return e}localCommandReceived(e,t){if(!this.localCommand){const i=new C(this._currentTick,e,t);this.localCommand=i,this.log.logInfo(`sending local command: ${i.toFullString()}`),this.net.broadcast(new R(i))}}remoteCommandReceived(e){this.log.logInfo(`received command: ${e.toFullString()}`),this.remoteCommands.push(e)}gameStateReceived(e){throw new Error("P2PDelayedNetCode: Method not implemented.")}getGameStateToRender(){return this.prevGameState?this.prevGameState:this._initialGameState}getGameState(e){return this._initialGameState.tick===e?this._initialGameState:this.prevGameState&&this.prevGameState.tick===e?this.prevGameState:null}}class A{constructor(e,i,s){t(this,"context"),t(this,"_debugBoxes",!0),this.log=e,this.canvas=i,this.netcode=s;const o=i.getContext("2d");if(!o)throw"Error getting context 2d";this.context=o}get debugBoxes(){return this._debugBoxes}set debugBoxes(e){this._debugBoxes=e}}class H{constructor(e,t,i,s,o,n,a,r){this.currentTime=e,this.currentGameState=t,this.currentGameStateTime=i,this.elapsed=s,this.nextGameState=o,this.nextGameStateTime=n,this.nextElapsed=a,this.tickTimeDiff=r}}class N extends A{constructor(e,t,i){super(e,t,i),this.log=e,this.canvas=t,this.netcode=i}render(e){e?this.renderWithInterpolation():this.renderAsIs()}renderAsIs(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e=this.netcode.getGameStateToRender().world.getBodyList();e;e=e.getNext())e.getUserData()&&(e.isStatic()?this.drawStaticBody(e):this.drawDynamicBody(e))}renderWithInterpolation(){let e=v();const t=this.netcode.getGameStateToRender(),i=this.netcode.tickTime(t.tick),s=this.netcode.getGameState(t.tick+1),o=s?this.netcode.tickTime(s.tick):void 0;o&&(e-=o-i),e>i+this.netcode.tickMs&&(e=i+this.netcode.tickMs);const n=new H(e,t,i,(e-i)/1e3,s,s?this.netcode.tickTime(s.tick):void 0,o?(e-o)/1e3:0,o?(o-i)/1e3:this.netcode.tickMs/1e3);this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let a=t.world.getBodyList();a;a=a.getNext())a.getUserData()&&(a.isStatic()?this.drawStaticBody(a):this.drawDynamicBodyWithInterpolation(a,n))}drawStaticBody(e){let t=e.getUserData().width,i=e.getUserData().height;this.context.fillStyle=S.border.color,this.context.fillRect(e.getPosition().x*S.physics.worldScale-t/2,e.getPosition().y*S.physics.worldScale-i/2,t,i)}drawDynamicBody(e){let t=e.getUserData();this.context.fillStyle=t.color,this.context.fillRect(e.getPosition().x*S.physics.worldScale-t.size/2,e.getPosition().y*S.physics.worldScale-t.size/2,t.size,t.size)}drawDynamicBodyWithInterpolation(e,t){let i,s,o,n=e.getUserData(),a=0,r=0;if(t.nextGameState){if(i=t.nextGameState.bodyFromPlayer(e.getUserData().id),i){const s=e.getPosition(),o=i.getPosition(),n=e.getLinearVelocity(),l=i.getLinearVelocity();a=Math.sign(n.x)===Math.sign(l.x)?s.x+t.elapsed*(o.x-s.x)/t.tickTimeDiff:t.elapsed<-t.nextElapsed?s.x+n.x*t.elapsed:o.x+l.x*t.nextElapsed,r=Math.sign(n.y)===Math.sign(l.y)?s.y+t.elapsed*(o.y-s.y)/t.tickTimeDiff:t.elapsed<-t.nextElapsed?s.y+n.y*t.elapsed:o.y+l.y*t.nextElapsed}}else a=e.getPosition().x+e.getLinearVelocity().x*t.elapsed,r=e.getPosition().y+e.getLinearVelocity().y*t.elapsed;this._debugBoxes&&(s=e.getPosition().x*S.physics.worldScale-n.size/2,o=e.getPosition().y*S.physics.worldScale-n.size/2,this.context.beginPath(),this.context.rect(s,o,n.size,n.size),this.context.strokeStyle="red",this.context.stroke(),i&&(s=i.getPosition().x*S.physics.worldScale-n.size/2,o=i.getPosition().y*S.physics.worldScale-n.size/2,this.context.beginPath(),this.context.rect(s,o,n.size,n.size),this.context.strokeStyle="blue",this.context.stroke())),s=a*S.physics.worldScale-n.size/2,o=r*S.physics.worldScale-n.size/2,this.context.fillStyle=n.color,this.context.fillRect(s,o,n.size,n.size)}}class j{constructor(e,t){this.log=e,this.step=t}compute(e){const t=e;for(let i of t.commands){if(!i||i.value===l)continue;const e=t.bodies.find((e=>(e.getUserData()?e.getUserData().id:-1)==i.playerId));if(e){const t=i.value==d||i.value==f||i.value==g?S.physics.strength:i.value==m||i.value==y||i.value==p?-1*S.physics.strength:0,s=i.value==h||i.value==y||i.value==f?S.physics.strength:i.value==c||i.value==p||i.value==g?-1*S.physics.strength:0;this.log.logInfo(`apply command value ${i.value} to P${i.playerId}: force(x=${t} y=${s})`),e.applyForce(o.Vec2(t,s),e.getWorldCenter())}}t.world.step(this.step),t.world.clearForces()}}class V{constructor(e,t,i,s,o,n,a,r){this.currentTime=e,this.currentGameState=t,this.currentGameStateTime=i,this.elapsed=s,this.nextGameState=o,this.nextGameStateTime=n,this.nextElapsed=a,this.tickTimeDiff=r}}class K extends A{constructor(e,t,i){super(e,t,i),this.log=e,this.canvas=t,this.netcode=i}render(e){e?this.renderWithInterpolation():this.renderAsIs()}renderAsIs(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.netcode.getGameStateToRender().bodies.forEach((e=>{e.isStatic?this.drawStaticBody(e):this.drawDynamicBody(e)}))}renderWithInterpolation(){let e=v();const t=this.netcode.getGameStateToRender(),i=this.netcode.tickTime(t.tick),s=this.netcode.getGameState(t.tick+1),o=s?this.netcode.tickTime(s.tick):void 0;o&&(e-=o-i),e>i+this.netcode.tickMs&&(e=i+this.netcode.tickMs);const n=new V(e,t,i,(e-i)/1e3,s,s?this.netcode.tickTime(s.tick):void 0,o?(e-o)/1e3:0,o?(o-i)/1e3:this.netcode.tickMs/1e3);this.context.clearRect(0,0,this.canvas.width,this.canvas.height),t.bodies.forEach((e=>{e.isStatic?this.drawStaticBody(e):this.drawDynamicBodyWithInterpolation(e,n)}))}drawStaticBody(e){this.context.fillStyle=e.color,this.context.fillRect(e.posX*S.physics.worldScale-e.width/2,e.posY*S.physics.worldScale-e.height/2,e.width,e.height)}drawDynamicBody(e){this.context.fillStyle=e.color,this.context.fillRect(e.posX*S.physics.worldScale-e.width/2,e.posY*S.physics.worldScale-e.height/2,e.width,e.height)}drawDynamicBodyWithInterpolation(e,t){let i,s,o,n=0,a=0;t.nextGameState?(i=t.nextGameState.bodyFromPlayer(e.id),i&&(n=Math.sign(e.velX)===Math.sign(i.velX)?e.posX+t.elapsed*(i.posX-e.posX)/t.tickTimeDiff:t.elapsed<-t.nextElapsed?e.posX+e.velX*t.elapsed:i.posX+i.velX*t.nextElapsed,a=Math.sign(e.velY)===Math.sign(i.velY)?e.posY+t.elapsed*(i.posY-e.posY)/t.tickTimeDiff:t.elapsed<-t.nextElapsed?e.posY+e.velY*t.elapsed:i.posY+i.velY*t.nextElapsed)):(n=e.posX+e.velX*t.elapsed,a=e.posY+e.velY*t.elapsed),this._debugBoxes&&(s=e.posX*S.physics.worldScale-e.width/2,o=e.posY*S.physics.worldScale-e.height/2,this.context.beginPath(),this.context.rect(s,o,e.width,e.height),this.context.strokeStyle="red",this.context.stroke(),i&&(s=i.posX*S.physics.worldScale-i.width/2,o=i.posY*S.physics.worldScale-i.height/2,this.context.beginPath(),this.context.rect(s,o,i.width,i.height),this.context.strokeStyle="blue",this.context.stroke())),s=n*S.physics.worldScale-e.width/2,o=a*S.physics.worldScale-e.height/2,this.context.fillStyle=e.color,this.context.fillRect(s,o,e.width,e.height)}}class q{constructor(e,i,s){t(this,"running",!1),t(this,"_log"),t(this,"_gameStateHistory"),t(this,"_networkInterface"),t(this,"_deviceUpdatedEmitter",new u),t(this,"netcode"),t(this,"gameStateMachine"),t(this,"renderer"),t(this,"_npcs",0),t(this,"_interpolation",!0),this.isServer=e,this.playerId=i,this.canvas=s,this._log=new G,this._networkInterface=new _(this._log),this._gameStateHistory=[]}get log(){return this._log}get deviceUpdatedEmitter(){return this._deviceUpdatedEmitter}get gameStateHistory(){return this._gameStateHistory}get interpolation(){return this._interpolation}set interpolation(e){this._interpolation=e}get debugBoxes(){return this.renderer.debugBoxes}set debugBoxes(e){this.renderer.debugBoxes=e}connect(e,t,i,s,o,n,a){const r=new w(this.playerId,this._log);r.minLatency=t,r.maxLatency=i,r.packetLoss=s;const l=new w(e.playerId,e._log);l.minLatency=o,l.maxLatency=n,l.packetLoss=a,this._networkInterface.connect(r,l),e._networkInterface.connect(l,r)}reset(){this._log.clear(),this._gameStateHistory=[]}play(e,t,i,s,o,n){this.gameStateMachine=s?new j(this._log,t/1e3):new $;let a=e.name+("cs"===e.type?this.isServer?"-server":"-client":"");const r=class{constructor(){}static build(e,t,i,s){switch(e){case"p2p-naive":return t.logInfo("Using p2p-naive netcode"),new F(t,i,s);case"p2p-delayed":return t.logInfo("Using p2p-delayed netcode"),new W(t,i,s);case"cs-lockstep-client":return t.logInfo("Using cs-lockstep-client netcode"),new U(t,i,s);case"cs-lockstep-server":return t.logInfo("Using cs-lockstep-server netcode"),new O(t,i,s);default:return t.logInfo(`Netcode ${e} not found`),null}}}.build(a,this._log,this._networkInterface,this.gameStateMachine);if(null===r)return;let l;if(this.netcode=r,this._npcs=i,this._interpolation=o,this.netcode.tickMs=t,s){const e=this.createPlanckWorld();l=new X(0,e),this.netcode.start(l)}else this.netcode.start();this.renderer=s?new N(this.log,this.canvas,this.netcode):new K(this.log,this.canvas,this.netcode),this.renderer.debugBoxes=n,this.running=!0,window.requestAnimationFrame((()=>{this.gameLoop()}))}stop(){this.running=!1,this._networkInterface.closeConnections(),this._networkInterface.resetEmitters()}gameStateHistoryLog(){const e=this._gameStateHistory.reverse().join("\n");return this._gameStateHistory.reverse(),e}createPlanckStaticBody(e,t,i,s,n){const a=e.createBody({type:"static"});a.setUserData({width:s,height:n}),a.createFixture(o.Box(s/2/S.physics.worldScale,n/2/S.physics.worldScale)),a.setPosition(o.Vec2((t+s/2)/S.physics.worldScale,(i+n/2)/S.physics.worldScale))}createPlanckWorld(){const e=o.Vec2(0,0),t=o.World(e);this.createPlanckStaticBody(t,0,0,this.canvas.width,S.physics.borderThickness),this.createPlanckStaticBody(t,0,this.canvas.height-S.physics.borderThickness,this.canvas.width,S.physics.borderThickness),this.createPlanckStaticBody(t,0,0,S.physics.borderThickness,this.canvas.height),this.createPlanckStaticBody(t,this.canvas.width-S.physics.borderThickness,0,S.physics.borderThickness,this.canvas.height);const i={density:0,restitution:.4};S.players.forEach((e=>{const s=t.createBody({type:"dynamic",position:o.Vec2((e.x+e.size/2)/S.physics.worldScale,(e.y+e.size/2)/S.physics.worldScale),allowSleep:!1,awake:!0});s.createFixture(o.Box(e.size/2/S.physics.worldScale,e.size/2/S.physics.worldScale),i),s.setUserData(e)}));const s={density:0,restitution:1};let n=20;for(let a=0;a<this._npcs;a++){const e=t.createBody({type:"dynamic",position:o.Vec2((35+a*n+10+8*(10-this._npcs))/S.physics.worldScale,(35+a*n+10+8*(10-this._npcs))/S.physics.worldScale),allowSleep:!1,awake:!0});e.createFixture(o.Box(10/S.physics.worldScale,10/S.physics.worldScale),s),e.setUserData({id:100+a,size:n,color:S.npc.color})}return t}gameLoop(){this.running&&(window.requestAnimationFrame((()=>{this.gameLoop()})),this.update(),this.draw())}update(){try{let e=this.netcode.tick();null!=e&&this._gameStateHistory.unshift(e)}catch(e){this._log.logError(e)}this._deviceUpdatedEmitter.notify()}draw(){this.renderer.render(this._interpolation)}}const J=new class{constructor(){t(this,"pressedKeys",[]),document.onkeydown=document.onkeyup=e=>{this.pressedKeys[e.keyCode]="keydown"===e.type}}isPressed(e){return this.pressedKeys[e]}};class Q extends q{constructor(e,t,i,s,o,n){super(!1,e,n),this.playerId=e,this.keyUp=t,this.keyDown=i,this.keyLeft=s,this.keyRight=o,this.canvas=n}update(){const e=(J.isPressed(this.keyUp)?c:J.isPressed(this.keyDown)?h:l)+(J.isPressed(this.keyLeft)?m:J.isPressed(this.keyRight)?d:l);this.netcode.localCommandReceived(this.playerId,e),super.update()}}class Z extends q{constructor(e,t){super(!0,e,t),this.playerId=e,this.canvas=t}}(new class{constructor(){t(this,"deviceServer"),t(this,"devicePlayer1"),t(this,"devicePlayer2"),t(this,"p2pmode",!0),t(this,"panelControl"),t(this,"panelCanvas1"),t(this,"panelGamestates1"),t(this,"panelLog1"),t(this,"panelCanvas2"),t(this,"panelGamestates2"),t(this,"panelLog2"),t(this,"panelCanvasS"),t(this,"panelGamestatesS"),t(this,"panelLogS"),this.deviceServer=new Z(0,document.getElementById("serverGameArea")),this.devicePlayer1=new Q(S.players[0].id,S.players[0].keyUp,S.players[0].keyDown,S.players[0].keyLeft,S.players[0].keyRight,document.getElementById("player1GameArea")),this.devicePlayer2=new Q(S.players[1].id,S.players[1].keyUp,S.players[1].keyDown,S.players[1].keyLeft,S.players[1].keyRight,document.getElementById("player2GameArea"))}build(){this.createWindows(),this.bootstrapAngular()}createWindows(){this.panelControl=n.create({headerTitle:"Control Panel",theme:"dimgrey",headerControls:{close:"remove",size:"xs"},panelSize:{width:"18em",height:"100%"},position:{my:"left-top",at:"left-top",offsetX:"0",offsetY:"0"},content:document.getElementById("controlPanel")}),this.panelGamestates1=n.create({headerTitle:"Player 1 Game States",theme:"DarkSlateBlue",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},resizeit:{handles:"n,s"},panelSize:{width:"22em",height:"50%"},position:{my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"0"},content:document.getElementById("player1GameStates")}),this.panelCanvas1=n.create({headerTitle:"Player 1 Canvas",theme:"DarkSlateBlue",contentOverflow:"hide",headerControls:{close:"remove",size:"xs"},panelSize:{width:"310px",height:"calc(250px + 4.5em)"},position:{my:"left-top",at:"left-top",offsetX:"calc(18em + (100vw - 40em - 620px) / 3)",offsetY:"0"},content:document.getElementById("player1Canvas")}),this.panelLog1=n.create({headerTitle:"Player 1 Logs",theme:"DarkSlateBlue",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(100vw - 40em)",height:"calc((100vh - 250px - 4.5em) / 2)"},position:{my:"left-top",at:"left-top",offsetX:"18em",offsetY:"calc(250px + 4.5em)"},content:document.getElementById("player1Logs")}),this.panelGamestates2=n.create({headerTitle:"Player 2 Game States",theme:"OliveDrab",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"350px",height:"50%"},position:{my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"50%"},content:document.getElementById("player2GameStates")}),this.panelCanvas2=n.create({headerTitle:"Player 2 Canvas",theme:"OliveDrab",contentOverflow:"hide",headerControls:{close:"remove",size:"xs"},panelSize:{width:"310px",height:"calc(250px + 4.5em)"},position:{my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em - 310px - (100vw - 40em - 620px) / 3)",offsetY:"0"},content:document.getElementById("player2Canvas")}),this.panelLog2=n.create({headerTitle:"Player 2 Logs",theme:"OliveDrab",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(100vw - 40em)",height:"calc((100vh - 250px - 4.5em) / 2)"},position:{my:"left-top",at:"left-top",offsetX:"18em",offsetY:"calc(250px + 4.5em + (100vh - 250px - 4.5em) / 2)"},content:document.getElementById("player2Logs")}),this.panelGamestatesS=n.create({headerTitle:"Server Game States",theme:"black",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"350px",height:"50%"},position:{my:"left-top",at:"left-top",offsetX:"calc(100vw - 350px)",offsetY:"50%"},content:document.getElementById("serverGameStates")}),this.panelCanvasS=n.create({headerTitle:'Server "Canvas"',theme:"black",contentOverflow:"hide",headerControls:{close:"remove",size:"xs"},panelSize:{width:"310px",height:"calc(250px + 4.5em)"},position:{my:"left-top",at:"left-top",offsetX:"calc(50vw + 350px)",offsetY:"0"},content:document.getElementById("serverCanvas")}),this.panelLogS=n.create({headerTitle:"Server Logs",theme:"black",contentOverflow:"auto",headerControls:{close:"remove",size:"xs"},panelSize:{width:"calc(100vw - 40em)",height:"calc((100vh - 250px - 4.5em) / 2)"},position:{my:"left-top",at:"left-top",offsetX:"350px",offsetY:"75%"},content:document.getElementById("serverLogs")})}resetLayout(){this.panelControl.reposition({my:"left-top",at:"left-top",offsetX:"0",offsetY:"0"}),this.panelControl.resize({width:"18em",height:"100%"}),this.p2pmode?(this.panelGamestates1.reposition({my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"0"}),this.panelGamestates1.resize({width:"22em",height:"50%"}),this.panelCanvas1.reposition({my:"left-top",at:"left-top",offsetX:"calc(18em + (100vw - 40em - 620px) / 3)",offsetY:"0"}),this.panelCanvas1.resize({width:"310px",height:"calc(250px + 4.5em)"}),this.panelLog1.reposition({my:"left-top",at:"left-top",offsetX:"18em",offsetY:"calc(250px + 4.5em)"}),this.panelLog1.resize({width:"calc(100vw - 40em)",height:"calc((100vh - 250px - 4.5em) / 2)"}),this.panelGamestates2.reposition({my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"50%"}),this.panelGamestates2.resize({width:"22em",height:"50%"}),this.panelCanvas2.reposition({my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em - 310px - (100vw - 40em - 620px) / 3)",offsetY:"0"}),this.panelCanvas2.resize({width:"310px",height:"calc(250px + 4.5em)"}),this.panelLog2.reposition({my:"left-top",at:"left-top",offsetX:"18em",offsetY:"calc(250px + 4.5em + (100vh - 250px - 4.5em) / 2)"}),this.panelLog2.resize({width:"calc(100vw - 40em)",height:"calc((100vh - 250px - 4.5em) / 2)"}),this.panelGamestatesS.reposition({my:"left-top",at:"left-top",offsetX:"1000vw",offsetY:"1000vh"}),this.panelCanvasS.reposition({my:"left-top",at:"left-top",offsetX:"1000vw",offsetY:"1000vh"}),this.panelLogS.reposition({my:"left-top",at:"left-top",offsetX:"1000vw",offsetY:"1000vh"})):(this.panelGamestates1.reposition({my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"0"}),this.panelGamestates1.resize({width:"22em",height:"33%"}),this.panelCanvas1.reposition({my:"left-top",at:"left-top",offsetX:"18em",offsetY:"0"}),this.panelCanvas1.resize({width:"310px",height:"calc(250px + 4.5em)"}),this.panelLog1.reposition({my:"left-top",at:"left-top",offsetX:"18em",offsetY:"calc(250px + 4.5em)"}),this.panelLog1.resize({width:"calc(100vw - 40em - 4em)",height:"calc(100vh - 250px - 4.5em - 4em)"}),this.panelGamestates2.reposition({my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"33%"}),this.panelGamestates2.resize({width:"22em",height:"33%"}),this.panelCanvas2.reposition({my:"left-top",at:"left-top",offsetX:"calc(18em + 310px)",offsetY:"0"}),this.panelCanvas2.resize({width:"310px",height:"calc(250px + 4.5em)"}),this.panelLog2.reposition({my:"left-top",at:"left-top",offsetX:"20em",offsetY:"calc(250px + 4.5em + 2em)"}),this.panelLog2.resize({width:"calc(100vw - 40em - 4em)",height:"calc(100vh - 250px - 4.5em - 4em)"}),this.panelGamestatesS.reposition({my:"left-top",at:"left-top",offsetX:"calc(100vw - 22em)",offsetY:"66%"}),this.panelGamestatesS.resize({width:"22em",height:"33%"}),this.panelCanvasS.reposition({my:"left-top",at:"left-top",offsetX:"calc(18em + 620px)",offsetY:"0"}),this.panelCanvasS.resize({width:"310px",height:"calc(250px + 4.5em)"}),this.panelLogS.reposition({my:"left-top",at:"left-top",offsetX:"22em",offsetY:"calc(250px + 4.5em + 4em)"}),this.panelLogS.resize({width:"calc(100vw - 40em - 4em)",height:"calc(100vh - 250px - 4.5em - 4em)"})),this.panelGamestates1.front(),this.panelGamestates2.front(),this.panelGamestatesS.front(),this.panelLog1.front(),this.panelLog2.front(),this.panelLogS.front(),this.panelCanvas1.front(),this.panelCanvas2.front(),this.panelCanvasS.front()}saveFile(e,t){const i=new Date,s=a.exports.createWriteStream(`${i.getFullYear()}${i.getMonth()}${i.getDate()}${i.getHours()}${i.getMinutes()}${i.getSeconds()}-${e}.log`).getWriter(),o=(new TextEncoder).encode(t);s.write(o),s.close()}bootstrapAngular(){r.module("app",[]).controller("mainCtrl",["$scope",e=>{e.info={btnStopEnabled:!1,btnPlayEnabled:!0,btnSaveEnabled:!0,playing:!1,tick:S.network.tickMs,netcodes:S.netcodes,algorithm:S.netcodes[0],latency1:{min:S.network.minLatency1,max:S.network.maxLatency1},packetLoss1:S.network.packetLoss1,latency2:{min:S.network.minLatency2,max:S.network.maxLatency2},packetLoss2:S.network.packetLoss2,npcs:0,realtimeGameStates:!1,realtimeLogs:!1,interpolation:!0,debugBoxes:!0,syncScrollGs1:!0,syncScrollGs2:!0,syncScrollGsS:!0,syncScrollLog1:!0,syncScrollLog2:!0,syncScrollLogS:!0,logsPlayer1:[],logsPlayer2:[],logsServer:[],gamestatesPlayer1:[],gamestatesPlayer2:[],gamestatesServer:[]};const t="p2p"===e.info.algorithm.type;this.p2pmode=t,this.resetLayout(),e.resetLayout=()=>{this.resetLayout()};const i=document.getElementById("player1GameStates"),s=document.getElementById("player2GameStates"),o=document.getElementById("serverGameStates");r.element(i.parentElement).bind("scroll",(()=>{e.info.syncScrollGs1&&(e.info.syncScrollGs2&&(s.parentElement.scrollTop=i.parentElement.scrollTop),e.info.syncScrollGsS&&(o.parentElement.scrollTop=i.parentElement.scrollTop))})),r.element(s.parentElement).bind("scroll",(()=>{e.info.syncScrollGs2&&(e.info.syncScrollGs1&&(i.parentElement.scrollTop=s.parentElement.scrollTop),e.info.syncScrollGsS&&(o.parentElement.scrollTop=s.parentElement.scrollTop))})),r.element(o.parentElement).bind("scroll",(()=>{e.info.syncScrollGsS&&(e.info.syncScrollGs1&&(i.parentElement.scrollTop=o.parentElement.scrollTop),e.info.syncScrollGs2&&(s.parentElement.scrollTop=o.parentElement.scrollTop))}));const n=document.getElementById("player1Logs"),a=document.getElementById("player2Logs"),l=document.getElementById("serverLogs");r.element(n.parentElement).bind("scroll",(()=>{e.info.syncScrollLog1&&(e.info.syncScrollLog2&&(a.parentElement.scrollTop=n.parentElement.scrollTop),e.info.syncScrollLogS&&(l.parentElement.scrollTop=n.parentElement.scrollTop))})),r.element(a.parentElement).bind("scroll",(()=>{e.info.syncScrollLog2&&(e.info.syncScrollLog1&&(n.parentElement.scrollTop=a.parentElement.scrollTop),e.info.syncScrollLogS&&(l.parentElement.scrollTop=a.parentElement.scrollTop))})),r.element(l.parentElement).bind("scroll",(()=>{e.info.syncScrollLogS&&(e.info.syncScrollLog1&&(n.parentElement.scrollTop=l.parentElement.scrollTop),e.info.syncScrollLog2&&(a.parentElement.scrollTop=l.parentElement.scrollTop))})),this.deviceServer.deviceUpdatedEmitter.addEventListener((()=>{e.$apply()})),this.devicePlayer1.deviceUpdatedEmitter.addEventListener((()=>{e.$apply()})),this.devicePlayer2.deviceUpdatedEmitter.addEventListener((()=>{e.$apply()}));const c='<button class="jsPanel-btn jsPanel-btn-menu jsPanel-btn-md tooltip bottom" aria-label="Sync scroll"><span class="fas fa-arrows-alt-v toolbar-icon" style="vertical-align: text-top"></span><input type="checkbox" checked /></button>',h='<button class="jsPanel-btn jsPanel-btn-menu jsPanel-btn-md tooltip bottom" aria-label="Download"><span class="fas fa-download toolbar-icon"></span></button>';this.panelGamestates1.addControl({html:c,name:"sync",position:1,handler:()=>{e.info.syncScrollGs1=!e.info.syncScrollGs1}}),this.panelGamestates1.addControl({html:h,name:"download",position:2,handler:()=>{e.saveGamestates1()}}),this.panelGamestates2.addControl({html:c,name:"sync",position:1,handler:()=>{e.info.syncScrollGs2=!e.info.syncScrollGs2}}),this.panelGamestates2.addControl({html:h,name:"download",position:2,handler:()=>{e.saveGamestates2()}}),this.panelGamestatesS.addControl({html:c,name:"sync",position:1,handler:()=>{e.info.syncScrollGsS=!e.info.syncScrollGsS}}),this.panelGamestatesS.addControl({html:h,name:"download",position:2,handler:()=>{e.saveGamestatesS()}}),this.panelLog1.addControl({html:c,name:"sync",position:1,handler:()=>{e.info.syncScrollLog1=!e.info.syncScrollLog1}}),this.panelLog1.addControl({html:h,name:"download",position:2,handler:()=>{e.saveLogs1()}}),this.panelLog2.addControl({html:c,name:"sync",position:1,handler:()=>{e.info.syncScrollLog2=!e.info.syncScrollLog2}}),this.panelLog2.addControl({html:h,name:"download",position:2,handler:()=>{e.saveLogs2()}}),this.panelLogS.addControl({html:c,name:"sync",position:1,handler:()=>{e.info.syncScrollLogS=!e.info.syncScrollLogS}}),this.panelLogS.addControl({html:h,name:"download",position:2,handler:()=>{e.saveLogsS()}}),e.changeAlgorithm=()=>{const t="p2p"===e.info.algorithm.type;t!==this.p2pmode&&(this.p2pmode=t,this.resetLayout())},e.stop=()=>{this.deviceServer.stop(),this.devicePlayer1.stop(),this.devicePlayer2.stop(),e.info.btnStopEnabled=!1,e.info.btnPlayEnabled=!0,e.info.playing=!1},e.play=()=>{this.deviceServer.reset(),this.devicePlayer1.reset(),this.devicePlayer2.reset(),"p2p"===e.info.algorithm.type?(this.devicePlayer1.connect(this.devicePlayer2,e.info.latency1.min,e.info.latency1.max,e.info.packetLoss1,e.info.latency2.min,e.info.latency2.max,e.info.packetLoss2),this.devicePlayer1.play(e.info.algorithm,e.info.tick,e.info.npcs,!0,e.info.interpolation,e.info.debugBoxes),this.devicePlayer2.play(e.info.algorithm,e.info.tick,e.info.npcs,!0,e.info.interpolation,e.info.debugBoxes)):(this.devicePlayer1.connect(this.deviceServer,e.info.latency1.min,e.info.latency1.max,e.info.packetLoss1,e.info.latency1.min,e.info.latency1.max,e.info.packetLoss1),this.devicePlayer2.connect(this.deviceServer,e.info.latency2.min,e.info.latency2.max,e.info.packetLoss2,e.info.latency2.min,e.info.latency2.max,e.info.packetLoss2),this.deviceServer.play(e.info.algorithm,e.info.tick,e.info.npcs,!0,!1,!1),this.devicePlayer1.play(e.info.algorithm,e.info.tick,e.info.npcs,!1,e.info.interpolation,e.info.debugBoxes),this.devicePlayer2.play(e.info.algorithm,e.info.tick,e.info.npcs,!1,e.info.interpolation,e.info.debugBoxes)),e.info.btnStopEnabled=!0,e.info.btnPlayEnabled=!1,e.info.playing=!0,e.info.gamestatesServer=this.deviceServer.gameStateHistory,e.info.gamestatesPlayer1=this.devicePlayer1.gameStateHistory,e.info.gamestatesPlayer2=this.devicePlayer2.gameStateHistory,e.info.logsServer=this.deviceServer.log.traces,e.info.logsPlayer1=this.devicePlayer1.log.traces,e.info.logsPlayer2=this.devicePlayer2.log.traces},e.changeInterpolation=()=>{this.devicePlayer1.interpolation=e.info.interpolation,this.devicePlayer2.interpolation=e.info.interpolation},e.changeDebugBoxes=()=>{this.devicePlayer1.debugBoxes=e.info.debugBoxes,this.devicePlayer2.debugBoxes=e.info.debugBoxes},e.saveAll=()=>{let t=`\n--------------------\nPLAYER 1 GAME STATES\n--------------------\n${this.devicePlayer1.gameStateHistoryLog()}\n-------------\nPLAYER 1 LOGS\n-------------\n${this.devicePlayer1.log}\n\n--------------------\nPLAYER 2 GAME STATES\n--------------------\n${this.devicePlayer2.gameStateHistoryLog()}\n-------------\nPLAYER 2 LOGS\n-------------\n${this.devicePlayer2.log}`;"p2p"!==e.info.algorithm.type&&(t+=`-----------------\nSERVER GAME STATES\n------------------\n${this.deviceServer.gameStateHistoryLog()}\n-----------\nSERVER LOGS\n-----------\n${this.deviceServer.log}`),this.saveFile(e.info.algorithm.name,t)},e.saveGamestates1=()=>{this.saveFile(`${e.info.algorithm.name}-p1-states`,this.devicePlayer1.gameStateHistoryLog())},e.saveLogs1=()=>{this.saveFile(`${e.info.algorithm.name}-p1-logs`,this.devicePlayer1.log.toString())},e.saveGamestates2=()=>{this.saveFile(`${e.info.algorithm.name}-p2-states`,this.devicePlayer2.gameStateHistoryLog())},e.saveLogs2=()=>{this.saveFile(`${e.info.algorithm.name}-p2-logs`,this.devicePlayer2.log.toString())},e.saveGamestatesS=()=>{this.saveFile(`${e.info.algorithm.name}-srv-states`,this.deviceServer.gameStateHistoryLog())},e.saveLogsS=()=>{this.saveFile(`${e.info.algorithm.name}-srv-logs`,this.deviceServer.log.toString())}}])}}).build();
